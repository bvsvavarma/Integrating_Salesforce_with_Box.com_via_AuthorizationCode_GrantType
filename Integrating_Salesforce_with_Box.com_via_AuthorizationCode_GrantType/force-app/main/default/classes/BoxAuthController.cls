public class BoxAuthController {
    public String body {set;get;}
    public SuperItemList[] dataList{set;get;}
    public PageReference authenticate(){
        return new PageReference('https://account.box.com/api/oauth2/authorize?client_id=o7w0huek5qurv2dq12tlibrqn8fc0568&response_type=code');
    }
    
    public void getAccessToken(){
        String authCode = apexpages.currentPage().getParameters().get('code');
        System.debug('authCode: '+ authCode);
        //https://developer.box.com/reference/post-oauth2-token/
        String endPoint = 'https://api.box.com/oauth2/token/';
        //Step 1 : Instantiate the HTTP Class
        Http http = new Http();
        
        //Step 2: Frame the HttpRequest
        HttpRequest req = new HttpRequest();
        req.setEndPoint(endPoint);
        req.setMethod('POST');
        req.setHeader('Accept', 'application/json');
        req.setBody('grant_type=authorization_code&code='+authCode+'&client_id=o7w0hXXXXXXXXXXXXXXXXXXXXXX&client_secret=EqjJSXXXXXXXXXXXXXXXXXX');
        HttpResponse response = http.send(req);
        //Step 3: Receive the response
        
        fromJSON d = (fromJSON) JSON.deserialize(response.getBody(), fromJSON.class);
        String accessToken = d.access_token;
        
        getFolders(accessToken);
    }
    
    public String getFolders(String accessToken){
        Http http = new Http();
        HttpRequest req = new HttpRequest();
        req.setMethod('GET');
        req.setEndPoint('https://api.box.com/2.0/folders/315732128667/items');
        req.setHeader('Accept','Application/json');
        req.setHeader('Authorization','Bearer ' + accessToken);
        HttpResponse res = http.send(req);
        body = res.getBody();
       
        dataList = new SuperItemList[]{};
        fromJSONApex d = (fromJSONApex) JSON.deserialize(body, fromJSONApex.class);
        for(Integer i = 0; i<d.entries.size(); i++){
            dataList.add(new SuperItemList(d.entries[i].id, d.entries[i].type_x, d.entries[i].name));
        }
        return res.getBody();
    }
    //
    //Generated by AdminBooster
    //
    public class SuperItemList{
        public String id_x{set;get;}
        public String type_x{set;get;}
        public String name_x{set;get;}
        
        public SuperItemList(String id_x, String type_x, String name_x){
            this.id_x = id_x;
            this.type_x = type_x;
            this.name_x = name_x;
        }
    }
    
    public class fromJSON{
        public String access_token;	//Db1cRWvCvca5ldSxxGCyV8w4kpypYMdg
        public Integer expires_in;	//3678
        public cls_restricted_to[] restricted_to;
        public String refresh_token;	//N7v9xHdcIuGHMx8CTIZSBiHniP8ACDeN1stxIdkRgOdp7hwdaMXrtPIp8WxCx3WC
        public String token_type;	//bearer
    }
    class cls_restricted_to {
	}
    
    //
//Generated by AdminBooster
//

    public class fromJSONApex{
        public Integer total_count;	//4
        public cls_entries[] entries;
        public Integer offset;	//0
        public Integer limit_x;	//100
        public cls_order[] order;
    }
    class cls_entries {
		public String type_x;	//file
		public String id;	//1828356316418
		public cls_file_version file_version;
		public String sequence_id;	//0
		public String etag;	//0
		public String sha1;	//183ceb967f8ffecaeaf58a42c576a8784dfb980c
		public String name;	//35526525_1738294108595.xls
	}
	class cls_file_version {
		public String type_x;	//file_version
		public String id;	//2015591020418
		public String sha1;	//183ceb967f8ffecaeaf58a42c576a8784dfb980c
	}
	class cls_order {
		public String by_x;	//type
		public String direction;	//ASC
	}
}